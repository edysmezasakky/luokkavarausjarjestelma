<!DOCTYPE html>
<html lang="fi">
    <head>
        <meta charset="utf-8">
        <title>Luokat</title>
        <style>
            body { font-family: Arial, sans-serif; margin: 20px;}
            table { border-collapse: collapse; width: 100%; margin-top: 10px;}
            th, td {border: 1px solid #ddd; padding:8px;}
            th { background: #f4f4f4; text-align: left;}
            .filters {margin-bottom: 15px;}
            .pagination button {margin: 0 3px;}
            .reserved { color: red; font-weight: bold;}
            .free {color: green; font-weight: bold;}
        </style>
    </head>

    <body>
        <h1>Luokat</h1>
        <div class="filters">
            <input type="text" id="searchInput" placeholder="Hae nimellä">
            <input type="number" id="capacityInput" placeholder="Min. kapasiteetti">
            <input type="text" id="locationInput" placeholder="Sijainti">
            <button onclick="applyFilters()">Suodata</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Nimi</th>
                    <th>Kapasiteetti</th>
                    <th>Sijainti</th>
                    <th>Kuvaus</th>
                    <th>Lisätty</th>
                    <th>Varaus päättyy</th>
                    <th>Status</th>
                    <th>Toiminto</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>

        <div class="pagination" id="pagination"></div>

        <script>
            let currentPage = 1;
            let totalPages =1;

            function fetchData(){
                const search = document.getElementById('searchInput').value;
                const capacity = document.getElementById('capacityInput').value;
                const location = document.getElementById('locationInput').value;

                const url= `classesApi.php?search
                ${encodeURIComponent(search)}&capacity=
                ${encodeURIComponent(capacity)}&location=
                ${encodeURIComponent(loaction)}&page=${currentPage}`;
            
            
                fetch(url)
                .then(response => response.json())
            .then(data => {
                renderTable(data.data);
                totalPages = data.totalPages;
                renderPagination();
            })
            .catch(err => console.error('Virhe datan haussa:', err));
            }
              
            function renderTable(classes){
                const tbody = document.getElementById('tableBody');
                tbody.iinerHTML = '';
                if (classes.length === 0){
                    tbody.innerHTML = '<tr><td>colspan="8">Ei luokkia löytynyt.</td></tr>';
                    return;
                }
                classes.forEach(c =>{
                    const reservedText = c.is_reserved == 1 ? '<span class= 
                    "reserved">Varattu</span>': '<span class="free">Vapaa</span>';
                    const endTime = c.end_time ?  c.end_time: '-';
                    const actionLink = c.is_reserved == 0 ? `<a href=
                    "varaa.html?id= ${c.id}">Siirry varaamaan</a>`: '-';
                    const row = `<tr>
                        <td>${c.name}</td>
                        <td>${c.capacity}</td>
                        <td>${c.location}</td>
                        <td>${c.description}</td>
                        <td>${c.created_at}</td>
                        <td>${endTime}</td>
                        <td>${reservedText}</td>
                        <td>${actionLink}</td>
                        </tr>`;
                        tbody.innerHTML += row;
                });
            }
            function renderPagination(){
                const paginationDiv = document.getElementById('pagination');
                paginationDiv.innerHTML = '';
                for (let i = 1; i <= totalPages; i++) {
                    const btn = document.createElement('button');
                    btn.textContent = i;
                    btn.onclick = () => { currentPage = i; fetchData(); };
                    if (i === currentPage) btn.style.fontWeight = 'bold';
                    paginationDiv.appendChild(btn);
                }
            }

            function applyFilters(){
                currentPage = 1;
                fetchData();
            }

            // Alustava haku
            fetchData();
        </script>
    </body>
</html>